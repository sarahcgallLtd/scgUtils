<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Weighting Your Data • scgUtils</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Weighting Your Data">
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">scgUtils</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/using-survey-data.html">Using scgUtils with Survey Data</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Function Explainers</h6></li>
    <li><a class="dropdown-item" href="../articles/uploading-data.html">Uploading &amp; Cleaning Data</a></li>
    <li><a class="dropdown-item" href="../articles/weight-your-data.html">Weighting Your Data</a></li>
    <li><a class="dropdown-item" href="../articles/crosstabs.html">Conducting Cross-Tabulation Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/creating-colour-palettes.html">Mastering Colour Selection</a></li>
    <li><a class="dropdown-item" href="../articles/visualising-data.html">Visualising Data</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/sarahcgall/scgUtils/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Weighting Your Data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/sarahcgall/scgUtils/blob/master/vignettes/articles/weight-your-data.rmd" class="external-link"><code>vignettes/articles/weight-your-data.rmd</code></a></small>
      <div class="d-none name"><code>weight-your-data.rmd</code></div>
    </div>

    
    
<style>
  .content p {
    margin-top: 30px !important;
  }

  details {
    margin-bottom: 40px;
  }

  .MathJax_Display {
    text-align: left !important;
  }
</style>
<p><br> In the realm of survey analysis, accurately reflecting the
broader population within your sample data is paramount. This accuracy
is often compromised by various factors, such as unequal probabilities
of selection or response biases, leading to over- or
under-representation of certain groups. The solution? Survey
weighting.</p>
<p>This article explores the essence of survey weighting, its types, and
dives into the practical application of these techniques in R, ensuring
your survey results truly mirror the population you’re studying. <br><br></p>
<div class="section level3">
<h3 id="understanding-survey-weighting">Understanding Survey Weighting<a class="anchor" aria-label="anchor" href="#understanding-survey-weighting"></a>
</h3>
<p>Survey weighting is a statistical technique applied to survey data to
adjust for discrepancies between the sample and the target population.
This adjustment is critical in instances where certain segments of the
population are overrepresented or underrepresented, potentially skewing
the survey results.<br><br></p>
<div class="section level5">
<h5 id="types-of-survey-weights">
<strong>Types of Survey Weights</strong><a class="anchor" aria-label="anchor" href="#types-of-survey-weights"></a>
</h5>
<ul>
<li>
<strong>Design Weights:</strong> These adjust for the unequal
probabilities of selection that arise in the survey’s sampling
design.</li>
<li>
<strong>Post-Stratification Weights:</strong> These weights adjust
the sample to align with known population characteristics, such as age,
gender, or income levels.</li>
<li>
<strong>Calibration Weights:</strong> A more generalised form of
post-stratification, calibration weights use auxiliary information to
ensure that survey estimates reflect certain population totals across
multiple categories.</li>
</ul>
<p><br> Deciding which type of weighting is most appropriate for your
survey data depends on the design of your survey, the available
auxiliary information, and the specific goals of your analysis. <br><br></p>
</div>
</div>
<div class="section level3">
<h3 id="the-basics-of-weighting">The Basics of Weighting<a class="anchor" aria-label="anchor" href="#the-basics-of-weighting"></a>
</h3>
<p>To illustrate the fundamental concept of weighting, consider a
scenario where the comparison between the sample and the actual (target)
population reveals an over-representation of females (55%) in the sample
compared to the actual population (51%) and an under-representation of
males. <br><br></p>
<div class="section level5">
<h5 id="visualising-sample-vs--actual-populations">
<strong>Visualising Sample vs. Actual Populations</strong><a class="anchor" aria-label="anchor" href="#visualising-sample-vs--actual-populations"></a>
</h5>
<p>Using <code>ggplot2</code>, we visualise this discrepancy by plotting
the gender distribution within two circles representing the sample and
target populations, respectively. While this visualisation depicts the
imbalance, our goal is to mathematically adjust this skew. <br><br><img src="weight-your-data_files/figure-html/basic1-1.png" width="100%"><br><br></p>
</div>
<div class="section level5">
<h5 id="calculating-and-applying-weights">
<strong>Calculating and Applying Weights</strong><a class="anchor" aria-label="anchor" href="#calculating-and-applying-weights"></a>
</h5>
<p>The adjustment process involves calculating weights based on the
target and sample proportions:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi><mo>=</mo><mfrac><mi>T</mi><mi>S</mi></mfrac></mrow><annotation encoding="application/x-tex">
W = \frac{T}{S}
</annotation></semantics></math></p>
<p>where:</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>W</mi><annotation encoding="application/x-tex">W</annotation></semantics></math>
is the weight to be applied,</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation></semantics></math>
is the target population proportion, and</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>S</mi><annotation encoding="application/x-tex">S</annotation></semantics></math>
is the sample population proportion.</li>
</ul>
<p><br><strong>For our gender example:</strong></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>W</mi><mtext mathvariant="normal">Female</mtext></msub><mo>=</mo><mfrac><mrow><mn>51</mn><mi>%</mi></mrow><mrow><mn>55</mn><mi>%</mi></mrow></mfrac><mo>≈</mo><mn>0.93</mn></mrow><annotation encoding="application/x-tex">
W_{\text{Female}} = \frac{51\%}{55\%} \approx 0.93
</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>W</mi><mtext mathvariant="normal">Male</mtext></msub><mo>=</mo><mfrac><mrow><mn>49</mn><mi>%</mi></mrow><mrow><mn>45</mn><mi>%</mi></mrow></mfrac><mo>≈</mo><mn>1.09</mn></mrow><annotation encoding="application/x-tex">
W_{\text{Male}} = \frac{49\%}{45\%} \approx 1.09
</annotation></semantics></math></p>
<p><br><strong>Applying these weights:</strong></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext mathvariant="normal">Weighted Sample</mtext><mtext mathvariant="normal">Female</mtext></msub><mo>=</mo><mn>0.93</mn><mo>×</mo><mn>55</mn><mi>%</mi><mo>=</mo><mn>51</mn><mi>%</mi></mrow><annotation encoding="application/x-tex">
\text{Weighted Sample}_{\text{Female}} = 0.93 \times 55\% = 51\%
</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext mathvariant="normal">Weighted Sample</mtext><mtext mathvariant="normal">Male</mtext></msub><mo>=</mo><mn>1.09</mn><mo>×</mo><mn>45</mn><mi>%</mi><mo>=</mo><mn>49</mn><mi>%</mi></mrow><annotation encoding="application/x-tex">
\text{Weighted Sample}_{\text{Male}} = 1.09 \times 45\% = 49\%
</annotation></semantics></math></p>
<p><br> The weighted sample proportions now align with the target
population, correcting the initial imbalance. <br><br></p>
</div>
</div>
<div class="section level3 tabset">
<h3 class="tabset" id="implementing-weighting-in-r">Implementing Weighting in R<a class="anchor" aria-label="anchor" href="#implementing-weighting-in-r"></a>
</h3>
<p>Two common weighting techniques are cell-based weighting and rake
weighting. Cell-based weighting applies a detailed post-stratification
by adjusting weights at intersections of multiple characteristics. Rake
weighting, under calibration weights, iteratively aligns sample weights
across various variables to match population margins. <br><br></p>


<ul class="nav nav-tabs" id="implementing-weighting-in-r" role="tablist">
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#cell-based" id="cell-based-tab" type="button" role="tab" aria-controls="cell-based" aria-selected="true" class="active nav-link"><strong>Cell-Based</strong></button></li>
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#raking" id="raking-tab" type="button" role="tab" aria-controls="raking" aria-selected="false" class="nav-link"><strong>Raking</strong></button></li>
</ul>
<div class="tab-content">
<div class="active  tab-pane" id="cell-based" role="tabpanel" aria-labelledby="cell-based-tab">

<p>Cell-based weighting fine-tunes survey weights to align the sample
distribution with known population margins across multiple dimensions or
characteristics. This method enables granular adjustments by considering
intersections of categories (e.g., specific age groups within each
gender). <br><br></p>
<p><strong>Implementing Cell-Based Weighting in R:</strong></p>
<p><strong><em>1. Clean and View Variables</em></strong><br> First, we
re-factor the <code>ageGroup</code> variable so that the subgroups of
<code>ageGroups</code> in the survey data aligns with the age groups in
the census data.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Using the practice dataset for survey weights, save as survey_df</span></span>
<span><span class="va">survey_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_data.html">get_data</a></span><span class="op">(</span><span class="st">"survey_wt"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">labelled</span><span class="fu">::</span><span class="fu"><a href="https://larmarange.github.io/labelled/reference/to_factor.html" class="external-link">unlabelled</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="../reference/process_factors.html">process_factors</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Refactor the ageGroup variable</span></span>
<span><span class="va">survey_df</span> <span class="op">&lt;-</span> <span class="fu">mutate</span><span class="op">(</span><span class="va">survey_df</span>,</span>
<span>                    ageGroup <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span></span>
<span>                      <span class="va">age</span> <span class="op">&lt;=</span> <span class="fl">24</span> <span class="op">~</span> <span class="st">"18-24"</span>,</span>
<span>                      <span class="va">age</span> <span class="op">&gt;</span> <span class="fl">24</span> <span class="op">&amp;</span> <span class="va">age</span> <span class="op">&lt;=</span> <span class="fl">34</span> <span class="op">~</span> <span class="st">"25-34"</span>,</span>
<span>                      <span class="va">age</span> <span class="op">&gt;</span> <span class="fl">34</span> <span class="op">&amp;</span> <span class="va">age</span> <span class="op">&lt;=</span> <span class="fl">44</span> <span class="op">~</span> <span class="st">"35-44"</span>,</span>
<span>                      <span class="va">age</span> <span class="op">&gt;</span> <span class="fl">44</span> <span class="op">&amp;</span> <span class="va">age</span> <span class="op">&lt;=</span> <span class="fl">54</span> <span class="op">~</span> <span class="st">"45-54"</span>,</span>
<span>                      <span class="va">age</span> <span class="op">&gt;</span> <span class="fl">54</span> <span class="op">&amp;</span> <span class="va">age</span> <span class="op">&lt;=</span> <span class="fl">64</span> <span class="op">~</span> <span class="st">"55-64"</span>,</span>
<span>                      <span class="va">age</span> <span class="op">&gt;</span> <span class="fl">64</span> <span class="op">~</span> <span class="st">"65 +"</span></span>
<span>                    <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><br></p>
<p>We can then view the population structure of the <code>gender</code>
and <code>ageGourp</code> variables within the dataset for a comparison
with the target population.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># View the population structure by age groups</span></span>
<span><span class="fu"><a href="../reference/plot_popn.html">plot_popn</a></span><span class="op">(</span><span class="va">survey_df</span>,</span>
<span>          xVar <span class="op">=</span> <span class="st">"gender"</span>,</span>
<span>          yVar <span class="op">=</span> <span class="st">"ageGroup"</span>,</span>
<span>          addLabels <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>          title <span class="op">=</span> <span class="st">"Unweighted Population Structure"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="weight-your-data_files/figure-html/cell-based2-1.png" width="100%"></p>
<table class="table">
<caption>Target Population Structure:</caption>
<thead><tr class="header">
<th align="left">Age Group</th>
<th align="left">Male</th>
<th align="left">Female</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">65 +</td>
<td align="left">10.6%</td>
<td align="left">12.6%</td>
</tr>
<tr class="even">
<td align="left">55-64</td>
<td align="left">7.8%</td>
<td align="left">8.1%</td>
</tr>
<tr class="odd">
<td align="left">45-54</td>
<td align="left">8.3%</td>
<td align="left">8.6%</td>
</tr>
<tr class="even">
<td align="left">35-44</td>
<td align="left">8.0%</td>
<td align="left">8.4%</td>
</tr>
<tr class="odd">
<td align="left">25-34</td>
<td align="left">8.2%</td>
<td align="left">8.7%</td>
</tr>
<tr class="even">
<td align="left">18-24</td>
<td align="left">5.4%</td>
<td align="left">5.3%</td>
</tr>
</tbody>
</table>
<p><br> Based on <a href="https://www.ons.gov.uk/datasets/create/filter-outputs/4bd97769-8b13-4e7c-8c95-0cc36e653283#get-data" class="external-link">2021
England and Wales</a> and <a href="https://www.scotlandscensus.gov.uk/webapi/jsf/login.xhtml?invalidSession=true&amp;reason=Session+not+established." class="external-link">2011
Scotland</a> census data, you can see that there is an
over-representation of the 65+ age group and under-representation of the
younger age groups for both genders which could be resolved with
cell-based weighting. <br><br></p>
<p><strong><em>2. Prepare Survey Objects</em></strong><br> Next, create
a new variable called <code>ageByGender</code> that represents every
unique conbination of <code>ageGroup</code> and <code>gender</code>
present in the census data and convert to factors.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Interlock the gender and ageGroup variables to make `ageByGender`</span></span>
<span><span class="va">survey_df</span><span class="op">$</span><span class="va">ageByGender</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">survey_df</span><span class="op">$</span><span class="va">gender</span>, <span class="va">survey_df</span><span class="op">$</span><span class="va">ageGroup</span>, sep <span class="op">=</span> <span class="st">" "</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View strata</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">survey_df</span><span class="op">$</span><span class="va">ageByGender</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "Female 18-24" "Female 25-34" "Female 35-44" "Female 45-54"</span></span>
<span><span class="co">#&gt;  [5] "Female 55-64" "Female 65 +"  "Male 18-24"   "Male 25-34"  </span></span>
<span><span class="co">#&gt;  [9] "Male 35-44"   "Male 45-54"   "Male 55-64"   "Male 65 +"</span></span></code></pre></div>
<p><br></p>
<p>Then, create a data frame containing the target population sourced
from the census data. This data frame should include a column for the
combined <code>ageByGender</code> category and a column for frequencies
(<code>Freq</code>). The name of the category column and the factor
levels of each subgroup must match those in the survey data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use total number of respondents to calculate target population frequencies</span></span>
<span><span class="co"># or actual population frequencies depnding on weighting purpose.</span></span>
<span><span class="va">sample_size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">survey_df</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create named vector of population percentages</span></span>
<span><span class="va">ageByGender</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>`Female 18-24` <span class="op">=</span> <span class="fl">5.27</span>,</span>
<span>                 `Male 18-24` <span class="op">=</span> <span class="fl">5.35</span>,</span>
<span>                 `Female 25-34` <span class="op">=</span> <span class="fl">8.70</span>,</span>
<span>                 `Male 25-34` <span class="op">=</span> <span class="fl">8.24</span>,</span>
<span>                 `Female 35-44` <span class="op">=</span> <span class="fl">8.44</span>,</span>
<span>                 `Male 35-44` <span class="op">=</span> <span class="fl">8.02</span>,</span>
<span>                 `Female 45-54` <span class="op">=</span> <span class="fl">8.59</span>,</span>
<span>                 `Male 45-54` <span class="op">=</span> <span class="fl">8.32</span>,</span>
<span>                 `Female 55-64` <span class="op">=</span> <span class="fl">8.06</span>,</span>
<span>                 `Male 55-64` <span class="op">=</span> <span class="fl">7.78</span>,</span>
<span>                 `Female 65 +` <span class="op">=</span> <span class="fl">12.64</span>,</span>
<span>                 `Male 65 +` <span class="op">=</span> <span class="fl">10.59</span><span class="op">)</span> <span class="op">/</span> <span class="fl">100</span> <span class="op">*</span> <span class="va">sample_size</span></span>
<span></span>
<span><span class="co"># Convert the named vectors into data frames</span></span>
<span><span class="va">ageByGender</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  ageByGender <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">ageByGender</span><span class="op">)</span>,</span>
<span>                       <span class="co"># ensure levels match those within survey_df</span></span>
<span>                       levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">survey_df</span><span class="op">$</span><span class="va">ageByGender</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  Freq <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">ageByGender</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><br></p>
<p>Finally, define the survey object using the <a href="https://r-survey.r-forge.r-project.org/survey/html/svydesign.html" class="external-link"><code>svydesign()</code></a>
function from the <code>survey</code> package. This will store all of
the unweighted variables and be used for weighting.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">design</span> <span class="op">&lt;-</span> <span class="fu">survey</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span>ids <span class="op">=</span> <span class="op">~</span><span class="fl">1</span>, <span class="co"># formula for no clusters</span></span>
<span>                            data <span class="op">=</span> <span class="va">survey_df</span>, <span class="co"># data frame containing variables</span></span>
<span>                            weights <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="co"># optional</span></span></code></pre></div>
<p><br></p>
<p><strong><em>3. Weight</em></strong><br> Perform the cell-based
weighting using the <a href="https://r-survey.r-forge.r-project.org/survey/html/postStratify.html" class="external-link"><code>postStratify()</code></a>
function and then add the results to your survey data frame.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cell_weighted</span> <span class="op">&lt;-</span> <span class="fu">survey</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/postStratify.html" class="external-link">postStratify</a></span><span class="op">(</span>design <span class="op">=</span> <span class="va">design</span>,</span>
<span>                                      strata <span class="op">=</span> <span class="op">~</span><span class="va">ageByGender</span>, <span class="co"># survey population</span></span>
<span>                                      population <span class="op">=</span> <span class="va">ageByGender</span><span class="op">)</span> <span class="co"># target population</span></span>
<span></span>
<span><span class="co"># Extract weights from the post-stratified design</span></span>
<span><span class="va">survey_df</span><span class="op">$</span><span class="va">wt_cell</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/weights.html" class="external-link">weights</a></span><span class="op">(</span><span class="va">cell_weighted</span><span class="op">)</span></span></code></pre></div>
<p><br><br></p>
</div>
<div class="tab-pane" id="raking" role="tabpanel" aria-labelledby="raking-tab">

<p>Raking, also known as the Random Iterative Method (RIM) or iterative
proportional fitting (IPF), refines the weight adjustment process by
simultaneously aligning sample weights across multiple variables (e.g.,
age, gender, geographic region) to match known population margins. This
method iteratively adjusts weights to ensure representativeness across
all considered dimensions. <br><br></p>
<p><strong>Implementing Rake Weighting in R:</strong></p>
<p><strong><em>1. Clean and View Variables</em></strong><br> This time,
we will re-factor the <code>p_past_vote_2019</code> variable so that the
subgroups align with the 2019 General Election results.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Ensure each subgroup aligns with 2019 election data/results</span></span>
<span><span class="va">survey_df</span> <span class="op">&lt;-</span> <span class="fu">mutate</span><span class="op">(</span><span class="va">survey_df</span>,</span>
<span>                    vote2019 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>                      <span class="fu">case_when</span><span class="op">(</span></span>
<span>                        <span class="va">p_past_vote_2019</span> <span class="op">==</span> <span class="st">"Conservative"</span> <span class="op">~</span> <span class="st">"Conservative"</span>,</span>
<span>                        <span class="va">p_past_vote_2019</span> <span class="op">==</span> <span class="st">"Labour"</span> <span class="op">~</span> <span class="st">"Labour"</span>,</span>
<span>                        <span class="va">p_past_vote_2019</span> <span class="op">==</span> <span class="st">"Liberal Democrat"</span> <span class="op">~</span> <span class="st">"Lib Dems"</span>,</span>
<span>                        <span class="va">p_past_vote_2019</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Scottish National Party (SNP)"</span>,</span>
<span>                                                <span class="st">"Plaid Cymru"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"National"</span>,</span>
<span>                        <span class="va">p_past_vote_2019</span> <span class="op">==</span> <span class="st">"Green Party"</span> <span class="op">~</span> <span class="st">"Green"</span>,</span>
<span>                        <span class="va">p_past_vote_2019</span> <span class="op">==</span> <span class="st">"Brexit Party/Reform UK"</span> <span class="op">~</span> <span class="st">"Brexit"</span>,</span>
<span>                        <span class="va">p_past_vote_2019</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"United Kingdom Independence Party (UKIP)"</span>,</span>
<span>                                                <span class="st">"An independent candidate"</span>,</span>
<span>                                                <span class="st">"Other"</span>,</span>
<span>                                                <span class="st">"Don't know"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Other"</span>,</span>
<span>                        .default <span class="op">=</span> <span class="st">"Did not vote"</span>,</span>
<span>                      <span class="op">)</span></span>
<span>                    <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><br></p>
<p>View the 2019 vote (<code>vote2019</code>) for a comparison with the
target vote.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">colours</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/colour_prep.html">colour_prep</a></span><span class="op">(</span><span class="va">survey_df</span>,</span>
<span>                       columns <span class="op">=</span> <span class="st">"vote2019"</span>,</span>
<span>                       pal_name <span class="op">=</span> <span class="st">"polUK"</span><span class="op">)</span></span>
<span><span class="va">colours</span><span class="op">$</span><span class="va">National</span> <span class="op">&lt;-</span> <span class="st">"#b6e559"</span> <span class="co"># add new colours for merged SNP + PC category</span></span>
<span></span>
<span><span class="co"># View the population structure by age groups</span></span>
<span><span class="fu"><a href="../reference/plot_bars.html">plot_bars</a></span><span class="op">(</span><span class="va">survey_df</span>,</span>
<span>          yVar <span class="op">=</span> <span class="st">"vote2019"</span>,</span>
<span>          title <span class="op">=</span> <span class="st">"Unweighted 2019 Vote"</span>,</span>
<span>          colours <span class="op">=</span> <span class="va">colours</span><span class="op">)</span></span></code></pre></div>
<p><img src="weight-your-data_files/figure-html/raking3-1.png" width="100%"></p>
<table class="table">
<caption>Target Results:</caption>
<thead><tr class="header">
<th align="left">Party</th>
<th align="left"></th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Conservative</td>
<td align="left">27.1%</td>
</tr>
<tr class="even">
<td align="left">Labour</td>
<td align="left">20.0%</td>
</tr>
<tr class="odd">
<td align="left">Lib Dems</td>
<td align="left">7.2%</td>
</tr>
<tr class="even">
<td align="left">National</td>
<td align="left">2.7%</td>
</tr>
<tr class="odd">
<td align="left">Green</td>
<td align="left">1.6%</td>
</tr>
<tr class="even">
<td align="left">Brexit</td>
<td align="left">1.3%</td>
</tr>
<tr class="odd">
<td align="left">Other</td>
<td align="left">2.1%</td>
</tr>
<tr class="even">
<td align="left">Did not vote</td>
<td align="left">38.0%</td>
</tr>
</tbody>
</table>
<p><br></p>
<p><strong><em>2. Prepare Survey Objects</em></strong><br> Following the
same approach as the cell-based weighting preparation, create a data
frame containing the target population sourced from the election data.
Again, this data frame should include a column called
<code>vote2019</code> and a column for frequencies (<code>Freq</code>).
Then, define the survey design object.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 2019 VOTE</span></span>
<span><span class="va">vote</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>Conservative <span class="op">=</span> <span class="fl">27.14</span>,</span>
<span>          Labour <span class="op">=</span> <span class="fl">19.96</span>,</span>
<span>          `Lib Dems` <span class="op">=</span> <span class="fl">7.18</span>,</span>
<span>          National <span class="op">=</span> <span class="fl">2.71</span>,</span>
<span>          Green <span class="op">=</span> <span class="fl">1.62</span>,</span>
<span>          Brexit <span class="op">=</span> <span class="fl">1.25</span>,</span>
<span>          Other <span class="op">=</span> <span class="fl">2.12</span>,</span>
<span>          `Did not vote` <span class="op">=</span> <span class="fl">38.02</span><span class="op">)</span> <span class="op">/</span> <span class="fl">100</span> <span class="op">*</span> <span class="va">sample_size</span></span>
<span></span>
<span><span class="co"># Convert the named vectors into data frames</span></span>
<span><span class="va">vote</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  vote2019 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">vote</span><span class="op">)</span>,</span>
<span>                    levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">survey_df</span><span class="op">$</span><span class="va">vote2019</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  Freq <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">vote</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Survey object</span></span>
<span><span class="va">design</span> <span class="op">&lt;-</span> <span class="fu">survey</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span>ids <span class="op">=</span> <span class="op">~</span><span class="fl">1</span>, <span class="co"># formula for no clusters</span></span>
<span>                            data <span class="op">=</span> <span class="va">survey_df</span>, <span class="co"># data frame containing variables</span></span>
<span>                            weights <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="co"># optional</span></span></code></pre></div>
<p><br></p>
<p><strong><em>3. Weight Data</em></strong><br> Finally, use the <a href="https://r-survey.r-forge.r-project.org/survey/html/rake.html" class="external-link"><code>rake()</code></a>
function from the <code>survey</code> package to perform raking and add
the results to the survey.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rake_weighted</span> <span class="op">&lt;-</span> <span class="fu">survey</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/rake.html" class="external-link">rake</a></span><span class="op">(</span><span class="va">design</span>,</span>
<span>                              sample.margins <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">~</span><span class="va">ageByGender</span>,</span>
<span>                                                    <span class="op">~</span><span class="va">vote2019</span><span class="op">)</span>,</span>
<span>                              population.margins <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">ageByGender</span>,</span>
<span>                                                        <span class="va">vote</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract weights from the post-stratified design</span></span>
<span><span class="va">survey_df</span><span class="op">$</span><span class="va">wt_raked</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/weights.html" class="external-link">weights</a></span><span class="op">(</span><span class="va">rake_weighted</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level3 unnumbered">
<h3 class="unnumbered" id="section"></h3>
<hr>
<div class="section level4">
<h4 id="comparing-weighting-results">
<strong>Comparing Weighting Results</strong><a class="anchor" aria-label="anchor" href="#comparing-weighting-results"></a>
</h4>
<p>After applying weights, it’s beneficial to compare the weighted
sample distributions against the target population metrics. This
comparison can validate the effectiveness of your weighting approach,
ensuring your survey results are as representative as possible:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_popn.html">plot_popn</a></span><span class="op">(</span><span class="va">survey_df</span>,</span>
<span>          xVar <span class="op">=</span> <span class="st">"gender"</span>,</span>
<span>          yVar <span class="op">=</span> <span class="st">"ageGroup"</span>,</span>
<span>          weight <span class="op">=</span> <span class="st">"wt_cell"</span>, <span class="co"># weighted result</span></span>
<span>          addLabels <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>          title <span class="op">=</span> <span class="st">"Weighted Population Structure"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="weight-your-data_files/figure-html/cell-based7-1.png" width="100%"></p>
<table class="table">
<caption>Target Population Structure:</caption>
<thead><tr class="header">
<th align="left">Age Group</th>
<th align="left">Male</th>
<th align="left">Female</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">65 +</td>
<td align="left">10.6%</td>
<td align="left">12.6%</td>
</tr>
<tr class="even">
<td align="left">55-64</td>
<td align="left">7.8%</td>
<td align="left">8.1%</td>
</tr>
<tr class="odd">
<td align="left">45-54</td>
<td align="left">8.3%</td>
<td align="left">8.6%</td>
</tr>
<tr class="even">
<td align="left">35-44</td>
<td align="left">8.0%</td>
<td align="left">8.4%</td>
</tr>
<tr class="odd">
<td align="left">25-34</td>
<td align="left">8.2%</td>
<td align="left">8.7%</td>
</tr>
<tr class="even">
<td align="left">18-24</td>
<td align="left">5.4%</td>
<td align="left">5.3%</td>
</tr>
</tbody>
</table>
<p><br></p>
<p>As you can see from the population structure, both of the raked and
cell-based weightings have corrected the over- and under-representation
of the older and younger age groups. The population structure of the
survey data now reflects that of the total population (as per the
census).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_bars.html">plot_bars</a></span><span class="op">(</span><span class="va">survey_df</span>,</span>
<span>          yVar <span class="op">=</span> <span class="st">"vote2019"</span>,</span>
<span>          weight <span class="op">=</span> <span class="st">"wt_raked"</span>, <span class="co"># weighted result</span></span>
<span>          title <span class="op">=</span> <span class="st">"Weighted 2019 Vote"</span>,</span>
<span>          colours <span class="op">=</span> <span class="va">colours</span><span class="op">)</span></span></code></pre></div>
<p><img src="weight-your-data_files/figure-html/raking5-1.png" width="100%"></p>
<table class="table">
<caption>Target Results:</caption>
<thead><tr class="header">
<th align="left">Party</th>
<th align="left"></th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Conservative</td>
<td align="left">27.1%</td>
</tr>
<tr class="even">
<td align="left">Labour</td>
<td align="left">20.0%</td>
</tr>
<tr class="odd">
<td align="left">Lib Dems</td>
<td align="left">7.2%</td>
</tr>
<tr class="even">
<td align="left">National</td>
<td align="left">2.7%</td>
</tr>
<tr class="odd">
<td align="left">Green</td>
<td align="left">1.6%</td>
</tr>
<tr class="even">
<td align="left">Brexit</td>
<td align="left">1.3%</td>
</tr>
<tr class="odd">
<td align="left">Other</td>
<td align="left">2.1%</td>
</tr>
<tr class="even">
<td align="left">Did not vote</td>
<td align="left">38.0%</td>
</tr>
</tbody>
</table>
<p><br></p>
<p>The weighting has also corrected the over- and under-representation
of the 2019 general election vote; in particular, the turnout.</p>
<p><br><br></p>
</div>
<div class="section level4">
<h4 id="other-considerations-and-limitations">
<strong>Other Considerations and Limitations</strong><a class="anchor" aria-label="anchor" href="#other-considerations-and-limitations"></a>
</h4>
<p>The choice between cell-based and rake weighting hinges on data
specifics and survey analysis requirements. Cell-based weighting is
preferable for detailed control when comprehensive population data is
available. Rake weighting suits broader alignment across multiple
characteristics without delving into their intersections.</p>
<p>Caution is necessary for subgroups with few or no respondents (e.g.,
no respondents in the Male 18-24 interlocked category), as this can
cause weight instability. Additionally, balancing adjustments across
multiple variables, can be complex if sample sizes are small or
variables are interrelated. Such scenarios underscore the importance of
thoughtful survey design and potentially setting quotas for response
collection.</p>
<p>By carefully selecting and applying the appropriate weighting method,
you can enhance the accuracy and reliability of your survey findings,
making them truly reflective of the broader population you aim to
understand.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.sarahcgall.co.uk/" class="external-link">Sarah Gall</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

  </div></footer>
</body>
</html>
